# REST vs（RPC/动作型）JSON API：本对话沟通内容整理

> 说明：这里的“JSON API”指**常见口语用法**——以 JSON 作为请求/响应体的数据接口（不特指 jsonapi.org 的 **JSON:API** 规范）。  
> 对比对象为：**REST（资源化、遵循 HTTP 语义）** vs **RPC/动作型 JSON API（URL 像方法名，常用 POST）**。

## 1. 概念区分（层面不同）
- **REST**：一种 Web API 的**架构风格/约束集合**（资源、HTTP 方法语义、无状态、统一接口、状态码、缓存等）。
- **JSON**：一种**数据表示格式**（序列化/传输结构）。
- 常见的“REST/JSON API”通常表示：**REST 风格 + JSON 表示**。

---

## 2. 两种设计的优劣对比（按维度简述）

### 2.1 语义清晰 / 可预测性
- **REST**：URL 表示资源、HTTP 方法表示操作（`GET /users/123`），可读性强、可预测。
- **RPC/动作型**：URL 往往是动作名（`POST /cancelOrder`），语义更多依赖命名和文档约定。

### 2.2 缓存友好（HTTP Cache）
- **REST**：查询通常用 `GET`，可直接使用 ETag、Cache-Control、304，利于浏览器/CDN/代理缓存。
- **RPC/动作型**：查询经常也用 `POST`，默认不利于缓存，需要额外策略或网关定制。

### 2.3 幂等性与重试安全
- **REST**：`GET/PUT/DELETE` 更易做到幂等；网络抖动或网关重试时更安全（语义明确）。
- **RPC/动作型**：大量 `POST` 写操作，重试可能造成重复执行（重复下单/扣费）；通常需要 **Idempotency-Key** 与服务端去重。

### 2.4 状态码与错误处理一致性
- **REST**：更倾向用标准 HTTP 状态码表达结果（401/403/404/409/422…），客户端与中间件可通用处理。
- **RPC/动作型**：常见做法是“永远 200，错误放 body.code/message”，一致性全靠团队自定义规范，通用工具难直接理解。

### 2.5 复杂业务动作表达（非 CRUD）
- **REST**：对“取消订单/重新计费/审核/导出”等动作，需要额外建模：
  - 子资源：`POST /orders/123/cancel`
  - 或命令资源：`POST /order-cancellations`
  设计成本更高，但更规范、可持续。
- **RPC/动作型**：动作就是 endpoint，本身非常直观，开发速度快。

### 2.6 聚合查询 / 批量操作
- **REST**：纯资源化可能导致多次请求；要做得好通常要配套过滤、分页、展开（expand）、批量端点等设计。
- **RPC/动作型**：一次请求携带复杂输入，返回聚合结果更自然，更像“调用服务方法”。

### 2.7 文档与对外易用性
- **REST**：模式统一，第三方更容易“猜到”接口行为，文档更容易标准化组织。
- **RPC/动作型**：接口像一组远程函数集合，依赖文档；命名不统一时学习成本更高。

### 2.8 网关治理 / 可观测性（限流、审计、监控、路由）
- **REST**：统一语义（资源+方法+状态码）更利于做通用治理策略与指标归类。
- **RPC/动作型**：也可治理，但通常更依赖“每个动作接口单独配置”，复用性较弱。

---

## 3. 简单例子

### 3.1 REST + JSON（资源化）
- `GET /users/123` → `200` 返回用户 JSON
- `PATCH /users/123` + JSON body → 更新用户

### 3.2 非 REST（RPC 风格）但使用 JSON
- `POST /user/get` + `{"id":123}`
- `POST /user/update` + `{"id":123,"name":"A"}`

---

## 4. 选型建议（对话结论的落地版）
- **对外开放平台 API / 多客户端 / 需要生态与治理能力**：优先 **REST（资源化）**。
- **内部系统 / 复杂流程动作多 / 强聚合与批量需求**：**RPC/动作型**更快更直接，但建议补齐规范：
  - 关键写操作：Idempotency-Key + 去重
  - 尽量区分查询与命令：查询优先 GET
  - 统一错误结构、分页、追踪字段（traceId/requestId）
- **折中方案（推荐常用）**：
  - CRUD 用 REST：`/orders/{id}`
  - 复杂动作用子路径或“动作标记”：`POST /orders/{id}/cancel` 或 `POST /orders/{id}:cancel`
  - 批量用明确批量端点：`POST /orders/batchGet`、`POST /orders/batchUpdate`

---

## 5. 一句话总结
- **REST**：长期可维护、生态友好、缓存/幂等/治理更“吃得上”HTTP 红利，但复杂动作需额外建模。
- **RPC/动作型 JSON API**：短期交付快、表达复杂业务直接，但更依赖自定义规范，长期治理成本可能更高。